<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯å¢ƒå˜é‡æ›¿æ¢æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        textarea {
            height: 100px;
        }
    </style>
</head>
<body>
    <h1>ç¯å¢ƒå˜é‡æ›¿æ¢åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>1. è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡</h2>
        <button onclick="setupTestEnvironment()">è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡</button>
        <div id="env-setup-result"></div>
    </div>

    <div class="test-section">
        <h2>2. æµ‹è¯•URLç¯å¢ƒå˜é‡æ›¿æ¢</h2>
        <p>è¾“å…¥åŒ…å«ç¯å¢ƒå˜é‡çš„URLï¼š</p>
        <input type="text" id="test-url" value="{{baseUrl}}/api/{{version}}/users" placeholder="{{baseUrl}}/api/{{version}}/users">
        <button onclick="testUrlReplacement()">æµ‹è¯•URLæ›¿æ¢</button>
        <div id="url-test-result"></div>
    </div>

    <div class="test-section">
        <h2>3. æµ‹è¯•å‚æ•°ç¯å¢ƒå˜é‡æ›¿æ¢</h2>
        <p>è¾“å…¥åŒ…å«ç¯å¢ƒå˜é‡çš„å‚æ•°å€¼ï¼š</p>
        <input type="text" id="test-param" value="{{apiKey}}" placeholder="{{apiKey}}">
        <button onclick="testParamReplacement()">æµ‹è¯•å‚æ•°æ›¿æ¢</button>
        <div id="param-test-result"></div>
    </div>

    <div class="test-section">
        <h2>4. æŸ¥çœ‹å½“å‰ç¯å¢ƒå˜é‡</h2>
        <button onclick="showCurrentEnvironment()">æ˜¾ç¤ºå½“å‰ç¯å¢ƒå˜é‡</button>
        <div id="current-env-result"></div>
    </div>

    <div class="test-section">
        <h2>5. æ¸…ç†æµ‹è¯•æ•°æ®</h2>
        <button onclick="clearTestData()">æ¸…ç†æµ‹è¯•æ•°æ®</button>
        <div id="clear-result"></div>
    </div>

    <script>
        // ç¯å¢ƒå˜é‡å¤„ç†å‡½æ•°ï¼ˆå¤åˆ¶è‡ªé¡¹ç›®ä¸­çš„å®ç°ï¼‰
        function processEnvironmentVariables(text) {
            if (!text || typeof text !== 'string') return text;

            return text.replace(/\{\{(\w+)\}\}/g, (match, varName) => {
                try {
                    const envVars = JSON.parse(localStorage.getItem('api_env_variables') || '{}');
                    return envVars[varName] || match;
                } catch (error) {
                    console.error('è·å–ç¯å¢ƒå˜é‡å¤±è´¥:', error);
                    return match;
                }
            });
        }

        // è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡
        function setupTestEnvironment() {
            const testEnvVars = {
                baseUrl: 'https://api.example.com',
                version: 'v1',
                apiKey: 'test-api-key-12345',
                token: 'bearer-token-67890'
            };

            localStorage.setItem('api_env_variables', JSON.stringify(testEnvVars));
            
            document.getElementById('env-setup-result').innerHTML = `
                <div class="test-result success">
                    âœ… æµ‹è¯•ç¯å¢ƒå˜é‡è®¾ç½®æˆåŠŸï¼<br>
                    è®¾ç½®çš„å˜é‡ï¼š<br>
                    ${Object.entries(testEnvVars).map(([key, value]) => `â€¢ ${key}: ${value}`).join('<br>')}
                </div>
            `;
        }

        // æµ‹è¯•URLæ›¿æ¢
        function testUrlReplacement() {
            const testUrl = document.getElementById('test-url').value;
            const originalUrl = testUrl;
            const processedUrl = processEnvironmentVariables(testUrl);
            
            const isReplaced = originalUrl !== processedUrl;
            const hasVariables = /\{\{(\w+)\}\}/g.test(originalUrl);
            
            let resultClass = 'info';
            let resultText = '';
            
            if (!hasVariables) {
                resultText = 'âš ï¸ è¾“å…¥çš„URLä¸­æ²¡æœ‰ç¯å¢ƒå˜é‡';
            } else if (isReplaced) {
                resultClass = 'success';
                resultText = `âœ… ç¯å¢ƒå˜é‡æ›¿æ¢æˆåŠŸï¼<br>åŸå§‹URL: ${originalUrl}<br>æ›¿æ¢å: ${processedUrl}`;
            } else {
                resultClass = 'error';
                resultText = `âŒ ç¯å¢ƒå˜é‡æ›¿æ¢å¤±è´¥ï¼<br>åŸå§‹URL: ${originalUrl}<br>ç»“æœ: ${processedUrl}`;
            }
            
            document.getElementById('url-test-result').innerHTML = `
                <div class="test-result ${resultClass}">
                    ${resultText}
                </div>
            `;
        }

        // æµ‹è¯•å‚æ•°æ›¿æ¢
        function testParamReplacement() {
            const testParam = document.getElementById('test-param').value;
            const originalParam = testParam;
            const processedParam = processEnvironmentVariables(testParam);
            
            const isReplaced = originalParam !== processedParam;
            const hasVariables = /\{\{(\w+)\}\}/g.test(originalParam);
            
            let resultClass = 'info';
            let resultText = '';
            
            if (!hasVariables) {
                resultText = 'âš ï¸ è¾“å…¥çš„å‚æ•°ä¸­æ²¡æœ‰ç¯å¢ƒå˜é‡';
            } else if (isReplaced) {
                resultClass = 'success';
                resultText = `âœ… å‚æ•°ç¯å¢ƒå˜é‡æ›¿æ¢æˆåŠŸï¼<br>åŸå§‹å‚æ•°: ${originalParam}<br>æ›¿æ¢å: ${processedParam}`;
            } else {
                resultClass = 'error';
                resultText = `âŒ å‚æ•°ç¯å¢ƒå˜é‡æ›¿æ¢å¤±è´¥ï¼<br>åŸå§‹å‚æ•°: ${originalParam}<br>ç»“æœ: ${processedParam}`;
            }
            
            document.getElementById('param-test-result').innerHTML = `
                <div class="test-result ${resultClass}">
                    ${resultText}
                </div>
            `;
        }

        // æ˜¾ç¤ºå½“å‰ç¯å¢ƒå˜é‡
        function showCurrentEnvironment() {
            try {
                const envVars = JSON.parse(localStorage.getItem('api_env_variables') || '{}');
                const envList = Object.entries(envVars);
                
                if (envList.length === 0) {
                    document.getElementById('current-env-result').innerHTML = `
                        <div class="test-result info">
                            âš ï¸ å½“å‰æ²¡æœ‰è®¾ç½®ä»»ä½•ç¯å¢ƒå˜é‡
                        </div>
                    `;
                } else {
                    document.getElementById('current-env-result').innerHTML = `
                        <div class="test-result info">
                            ğŸ“‹ å½“å‰ç¯å¢ƒå˜é‡ï¼š<br>
                            ${envList.map(([key, value]) => `â€¢ ${key}: ${value}`).join('<br>')}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('current-env-result').innerHTML = `
                    <div class="test-result error">
                        âŒ è¯»å–ç¯å¢ƒå˜é‡å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }

        // æ¸…ç†æµ‹è¯•æ•°æ®
        function clearTestData() {
            localStorage.removeItem('api_env_variables');
            document.getElementById('clear-result').innerHTML = `
                <div class="test-result success">
                    âœ… æµ‹è¯•æ•°æ®å·²æ¸…ç†
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰ç¯å¢ƒå˜é‡
        window.onload = function() {
            showCurrentEnvironment();
        };
    </script>
</body>
</html>
