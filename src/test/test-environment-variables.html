<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯å¢ƒå˜é‡è§£æåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #1890ff;
            text-align: center;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #1890ff;
            padding-bottom: 10px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #d9d9d9;
            border-radius: 6px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        button {
            background-color: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #40a9ff;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background-color: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background-color: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .info {
            background-color: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #1890ff;
        }
        .env-vars {
            background-color: #fafafa;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .code-block {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ç¯å¢ƒå˜é‡è§£æåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="container">
        <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•APIè°ƒè¯•å·¥å…·ä¸­çš„ç¯å¢ƒå˜é‡è§£æåŠŸèƒ½ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæµ‹è¯•ï¼š</p>
        <ol>
            <li>é¦–å…ˆè®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡</li>
            <li>æµ‹è¯•å„ç§åœºæ™¯ä¸‹çš„ç¯å¢ƒå˜é‡æ›¿æ¢</li>
            <li>éªŒè¯ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸ</li>
        </ol>
    </div>

    <div class="container">
        <div class="test-section">
            <h2>1. è®¾ç½®æµ‹è¯•ç¯å¢ƒå˜é‡</h2>
            <div class="input-group">
                <label>ç¯å¢ƒå˜é‡JSONï¼ˆå°†ä¿å­˜åˆ°localStorageï¼‰:</label>
                <textarea id="env-vars" placeholder='{"baseUrl": "https://api.example.com", "token": "abc123", "userId": "12345"}'></textarea>
            </div>
            <button onclick="setEnvironmentVariables()">è®¾ç½®ç¯å¢ƒå˜é‡</button>
            <button onclick="loadEnvironmentVariables()">åŠ è½½å½“å‰ç¯å¢ƒå˜é‡</button>
            <div id="env-result"></div>
        </div>

        <div class="test-section">
            <h2>2. æµ‹è¯•URLç¯å¢ƒå˜é‡æ›¿æ¢</h2>
            <div class="input-group">
                <label>æµ‹è¯•URL:</label>
                <input type="text" id="test-url" placeholder="{{baseUrl}}/api/{{version}}/users/{{userId}}" value="{{baseUrl}}/api/{{version}}/users/{{userId}}">
            </div>
            <button onclick="testUrlReplacement()">æµ‹è¯•URLæ›¿æ¢</button>
            <div id="url-result"></div>
        </div>

        <div class="test-section">
            <h2>3. æµ‹è¯•Queryå‚æ•°ç¯å¢ƒå˜é‡æ›¿æ¢</h2>
            <div class="input-group">
                <label>å‚æ•°é”®:</label>
                <input type="text" id="param-key" placeholder="api_key" value="api_key">
            </div>
            <div class="input-group">
                <label>å‚æ•°å€¼:</label>
                <input type="text" id="param-value" placeholder="{{token}}" value="{{token}}">
            </div>
            <button onclick="testParamReplacement()">æµ‹è¯•å‚æ•°æ›¿æ¢</button>
            <div id="param-result"></div>
        </div>

        <div class="test-section">
            <h2>4. æµ‹è¯•Headersç¯å¢ƒå˜é‡æ›¿æ¢</h2>
            <div class="input-group">
                <label>Headerå:</label>
                <input type="text" id="header-key" placeholder="Authorization" value="Authorization">
            </div>
            <div class="input-group">
                <label>Headerå€¼:</label>
                <input type="text" id="header-value" placeholder="Bearer {{token}}" value="Bearer {{token}}">
            </div>
            <button onclick="testHeaderReplacement()">æµ‹è¯•Headeræ›¿æ¢</button>
            <div id="header-result"></div>
        </div>

        <div class="test-section">
            <h2>5. æµ‹è¯•è¯·æ±‚ä½“ç¯å¢ƒå˜é‡æ›¿æ¢</h2>
            <div class="input-group">
                <label>JSONè¯·æ±‚ä½“:</label>
                <textarea id="body-json" placeholder='{"user_id": "{{userId}}", "token": "{{token}}"}'>{
  "user_id": "{{userId}}",
  "token": "{{token}}",
  "api_key": "{{apiKey}}"
}</textarea>
            </div>
            <button onclick="testBodyReplacement()">æµ‹è¯•è¯·æ±‚ä½“æ›¿æ¢</button>
            <div id="body-result"></div>
        </div>

        <div class="test-section">
            <h2>6. ç»¼åˆæµ‹è¯•</h2>
            <button onclick="runComprehensiveTest()">è¿è¡Œç»¼åˆæµ‹è¯•</button>
            <div id="comprehensive-result"></div>
        </div>

        <div class="test-section">
            <h2>7. æ¸…ç†æµ‹è¯•æ•°æ®</h2>
            <button onclick="clearTestData()">æ¸…ç†ç¯å¢ƒå˜é‡</button>
            <div id="clear-result"></div>
        </div>
    </div>

    <script>
        // ç¯å¢ƒå˜é‡å¤„ç†å‡½æ•°ï¼ˆå¤åˆ¶è‡ªé¡¹ç›®å®ç°ï¼‰
        function processEnvironmentVariables(text) {
            if (!text || typeof text !== 'string') return text;

            return text.replace(/\{\{(\w+)\}\}/g, (match, varName) => {
                try {
                    const envVars = JSON.parse(localStorage.getItem('api_env_variables') || '{}');
                    return envVars[varName] || match;
                } catch (error) {
                    console.error('è·å–ç¯å¢ƒå˜é‡å¤±è´¥:', error);
                    return match;
                }
            });
        }

        // è®¾ç½®ç¯å¢ƒå˜é‡
        function setEnvironmentVariables() {
            const envVarsText = document.getElementById('env-vars').value;
            try {
                const envVars = JSON.parse(envVarsText);
                localStorage.setItem('api_env_variables', JSON.stringify(envVars));
                document.getElementById('env-result').innerHTML = `
                    <div class="result success">
                        âœ… ç¯å¢ƒå˜é‡è®¾ç½®æˆåŠŸï¼<br>
                        å·²è®¾ç½®å˜é‡: ${Object.keys(envVars).join(', ')}
                    </div>
                `;
            } catch (error) {
                document.getElementById('env-result').innerHTML = `
                    <div class="result error">
                        âŒ JSONæ ¼å¼é”™è¯¯: ${error.message}
                    </div>
                `;
            }
        }

        // åŠ è½½å½“å‰ç¯å¢ƒå˜é‡
        function loadEnvironmentVariables() {
            try {
                const envVars = JSON.parse(localStorage.getItem('api_env_variables') || '{}');
                document.getElementById('env-vars').value = JSON.stringify(envVars, null, 2);
                document.getElementById('env-result').innerHTML = `
                    <div class="result info">
                        ğŸ“‹ å½“å‰ç¯å¢ƒå˜é‡å·²åŠ è½½åˆ°ç¼–è¾‘æ¡†
                    </div>
                `;
            } catch (error) {
                document.getElementById('env-result').innerHTML = `
                    <div class="result error">
                        âŒ åŠ è½½ç¯å¢ƒå˜é‡å¤±è´¥: ${error.message}
                    </div>
                `;
            }
        }

        // æµ‹è¯•URLæ›¿æ¢
        function testUrlReplacement() {
            const testUrl = document.getElementById('test-url').value;
            const originalUrl = testUrl;
            const processedUrl = processEnvironmentVariables(testUrl);
            
            const isReplaced = originalUrl !== processedUrl;
            const hasVariables = /\{\{(\w+)\}\}/g.test(originalUrl);
            
            let resultClass = 'info';
            let resultText = '';
            
            if (!hasVariables) {
                resultText = 'âš ï¸ è¾“å…¥çš„URLä¸­æ²¡æœ‰ç¯å¢ƒå˜é‡';
            } else if (isReplaced) {
                resultClass = 'success';
                resultText = `âœ… URLç¯å¢ƒå˜é‡æ›¿æ¢æˆåŠŸï¼<br>åŸå§‹: ${originalUrl}<br>æ›¿æ¢å: ${processedUrl}`;
            } else {
                resultClass = 'error';
                resultText = `âŒ URLç¯å¢ƒå˜é‡æ›¿æ¢å¤±è´¥ï¼<br>åŸå§‹: ${originalUrl}<br>ç»“æœ: ${processedUrl}`;
            }
            
            document.getElementById('url-result').innerHTML = `
                <div class="result ${resultClass}">
                    ${resultText}
                </div>
            `;
        }

        // æµ‹è¯•å‚æ•°æ›¿æ¢
        function testParamReplacement() {
            const paramKey = document.getElementById('param-key').value;
            const paramValue = document.getElementById('param-value').value;
            
            const processedKey = processEnvironmentVariables(paramKey);
            const processedValue = processEnvironmentVariables(paramValue);
            
            const keyChanged = paramKey !== processedKey;
            const valueChanged = paramValue !== processedValue;
            
            document.getElementById('param-result').innerHTML = `
                <div class="result ${(keyChanged || valueChanged) ? 'success' : 'info'}">
                    ${keyChanged || valueChanged ? 'âœ…' : 'ğŸ“‹'} å‚æ•°å¤„ç†ç»“æœ:<br>
                    é”®: ${paramKey} â†’ ${processedKey}<br>
                    å€¼: ${paramValue} â†’ ${processedValue}
                </div>
            `;
        }

        // æµ‹è¯•Headeræ›¿æ¢
        function testHeaderReplacement() {
            const headerKey = document.getElementById('header-key').value;
            const headerValue = document.getElementById('header-value').value;
            
            const processedKey = processEnvironmentVariables(headerKey);
            const processedValue = processEnvironmentVariables(headerValue);
            
            const keyChanged = headerKey !== processedKey;
            const valueChanged = headerValue !== processedValue;
            
            document.getElementById('header-result').innerHTML = `
                <div class="result ${(keyChanged || valueChanged) ? 'success' : 'info'}">
                    ${keyChanged || valueChanged ? 'âœ…' : 'ğŸ“‹'} Headerå¤„ç†ç»“æœ:<br>
                    ${processedKey}: ${processedValue}
                </div>
            `;
        }

        // æµ‹è¯•è¯·æ±‚ä½“æ›¿æ¢
        function testBodyReplacement() {
            const bodyJson = document.getElementById('body-json').value;
            const processedBody = processEnvironmentVariables(bodyJson);
            
            const isChanged = bodyJson !== processedBody;
            
            document.getElementById('body-result').innerHTML = `
                <div class="result ${isChanged ? 'success' : 'info'}">
                    ${isChanged ? 'âœ…' : 'ğŸ“‹'} è¯·æ±‚ä½“å¤„ç†ç»“æœ:<br>
                    <div class="code-block">${processedBody}</div>
                </div>
            `;
        }

        // ç»¼åˆæµ‹è¯•
        function runComprehensiveTest() {
            const testCases = [
                { type: 'URL', input: '{{baseUrl}}/api/{{version}}/users' },
                { type: 'Header', input: 'Bearer {{token}}' },
                { type: 'Param', input: '{{userId}}' },
                { type: 'Body', input: '{"id": "{{userId}}", "key": "{{apiKey}}"}' }
            ];
            
            let results = '<h3>ç»¼åˆæµ‹è¯•ç»“æœ:</h3>';
            
            testCases.forEach(testCase => {
                const processed = processEnvironmentVariables(testCase.input);
                const isChanged = testCase.input !== processed;
                results += `
                    <div style="margin-bottom: 10px;">
                        <strong>${testCase.type}:</strong><br>
                        è¾“å…¥: <code>${testCase.input}</code><br>
                        è¾“å‡º: <code>${processed}</code>
                        ${isChanged ? ' âœ…' : ' âš ï¸'}
                    </div>
                `;
            });
            
            document.getElementById('comprehensive-result').innerHTML = `
                <div class="result info">
                    ${results}
                </div>
            `;
        }

        // æ¸…ç†æµ‹è¯•æ•°æ®
        function clearTestData() {
            localStorage.removeItem('api_env_variables');
            document.getElementById('clear-result').innerHTML = `
                <div class="result success">
                    âœ… ç¯å¢ƒå˜é‡å·²æ¸…ç†
                </div>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤ç¯å¢ƒå˜é‡
        window.onload = function() {
            const defaultEnvVars = {
                "baseUrl": "https://api.example.com",
                "version": "v1",
                "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",
                "userId": "12345",
                "apiKey": "sk-1234567890abcdef"
            };
            
            document.getElementById('env-vars').value = JSON.stringify(defaultEnvVars, null, 2);
        };
    </script>
</body>
</html>
